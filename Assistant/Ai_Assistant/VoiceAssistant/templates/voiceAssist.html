<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Assistant</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, #2a2a3d, #1a1a2e);
            color: white;
            overflow: hidden;
            animation: bgAnimation 10s ease-in-out infinite;
        }

        @keyframes bgAnimation {
            0% { background: radial-gradient(circle, #2a2a3d, #1a1a2e); }
            50% { background: radial-gradient(circle, #1a1a2e, #2a2a3d); }
            100% { background: radial-gradient(circle, #2a2a3d, #1a1a2e); }
        }

        .container {
            text-align: center;
            padding: 50px;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        h1 {
            font-size: 2rem;
            color:rgb(104, 182, 235);  /* Simple and modern font color */
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .assistant {
            margin-top: 40px;
        }

        #mic-button {
            width: 140px;
            height: 140px;
            background: radial-gradient(circle, #66c2ff, #0044cc);
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.2);
            transition: transform 0.3s, box-shadow 0.3s ease-in-out;
        }

        #mic-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 35px rgba(0, 255, 255, 0.4);
        }

        .mic-icon {
            width: 70px;
            height: 70px;
            fill: white;
        }

        .response-container {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px 30px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.2);
            animation: fadeIn 1s ease-in-out;
            font-family: 'Roboto', sans-serif;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #response {
            font-size: 1.3rem;
            color: #66c2ff;
            font-weight: bold;
            text-align: center;
        }
        .instructions {
            font-size: 1rem;
            color: #fff;
            margin-top: 20px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container"{% csrf_token %}>
        <h1>Voice Assistant</h1>
        <div class="assistant">
            <button id="mic-button">
                <svg class="mic-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm4.3-3c0 2.2-1.82 4-4.3 4s-4.3-1.8-4.3-4H7c0 2.76 2.24 5 5 5s5-2.24 5-5h-1.7zm-2 5H10.7v1.3c0 .39.26.7.65.7h.3c.39 0 .65-.31.65-.7V16z"/>
                </svg>
            </button>
            <div class="response-container">
                <p id="response">Press the mic to start talking...</p>
            </div>
            <div class="instructions">
                <p>Say something like: "Hello?" or any query to interact.</p>
            </div>
        </div>
    </div>
    {% comment %} <script>
        debugger;
        const micButton = document.getElementById('mic-button');
        const responseElement = document.getElementById('response');
        debugger;
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';
        recognition.continuous = false;

        micButton.addEventListener('click', () => {
            responseElement.textContent = "Listening...";
            recognition.start();
        });
        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript.toLowerCase();
            debugger;
            if (transcript.includes("hello")) { // Use lowercase "hello" here
                responseElement.textContent = "I'm here to assist you! What can I do for you today?";
                speak("I'm here to assist you! What can I do for you today?");
            } else {
                responseElement.textContent = "I didn't quite catch that. Please say 'How can I help you'?";
                speak("I didn't quite catch that. Please say 'Hello'?");
            }
        };
        
        recognition.onerror = function(event) {
            responseElement.textContent = "Sorry, there was an error with the voice recognition.";
        };

        function speak(text) {
            const speech = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(speech);
        }
    </script> {% endcomment %}
    <script>
        const micButton = document.getElementById('mic-button');
        const responseElement = document.getElementById('response');
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';
        recognition.continuous = false;
    
        micButton.addEventListener('click', () => {
            responseElement.textContent = "Listening...";
            recognition.start();
        });
    
        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript.trim().toLowerCase(); // Clean transcript
            console.log("Transcript:", transcript);
    
            if (transcript.includes("hello")) {
                responseElement.textContent = "I'm here to assist you! Calling Python function...";
                speak("I'm here to assist you! Calling Python function...");
    
                // Make a POST request to the Django backend
                fetch('/handle-hello/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken() // Include CSRF token
                    },
                    body: JSON.stringify({ command: "hello" })
                })
                .then(response => response.json())
                .then(data => {
                    console.log("Response from Django:", data);
                    responseElement.textContent = data.message || "Python function executed.";
                })
                .catch(error => {
                    console.error("Error:", error);
                    responseElement.textContent = "Error calling Python function.";
                });
            } else {
                responseElement.textContent = "I didn't quite catch that. Please say 'Hello'?";
                speak("I didn't quite catch that. Please say 'Hello'?");
            }
        };
    
        recognition.onerror = function(event) {
            responseElement.textContent = `Error: ${event.error}. Please try again.`;
            console.error("Recognition Error:", event.error);
        };
    
        function speak(text) {
            const speech = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(speech);
        }
    
        // Function to get CSRF token from cookies
        function getCSRFToken() {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'csrftoken') {
                    return value;
                }
            }
            return '';
        }
    </script>
    
</body>
</html>
